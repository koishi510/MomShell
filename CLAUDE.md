# CLAUDE - MomShell AI 康复教练方案

## 目标

功能三：AI 康复反馈 (Smart Recovery Coach)

1. 技术实现方案：

姿态估计（Pose Estimation）： 利用 MediaPipe 或类似框架，在本地端实现 18-33 个关键点识别（无需将视频上传云端，保护隐私）。

产后特化算法： 重点监测腹直肌分离保护、盆底肌代偿行为、脊柱排列。

2. 实时引导与反馈循环：

AR 镜像引导： 屏幕一边显示标准动作演示，另一边显示用户镜像。AI 在镜像上通过线条/颜色（如红绿光圈）实时纠偏。

语音纠偏示例：

错误： "动作不对，请重试。"（×）

正确： "试着呼气时收紧小腹，保护好你的腰椎，做得很好，慢一点。"（√）

系统监测到用户动作形变严重或呼吸急促时，强制提示停下休息，避免运动损伤。

3. 数据可视化：

不强调"减重斤数"，而强调"力量找回程度"和"体态改善曲线"，通过可视化的动态勋章鼓励用户。

（可以仿照多邻国/keep软件，让页面更有趣味，促进坚持）

---

## 技术架构设计

### 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                     前端 (Web Browser)                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 摄像头采集   │  │ 标准动作演示 │  │ 数据可视化仪表盘    │  │
│  │ + AR叠加层  │  │ (视频/动画)  │  │ (进度/勋章)         │  │
│  └──────┬──────┘  └─────────────┘  └─────────────────────┘  │
│         │ WebSocket (实时帧传输)                             │
└─────────┼───────────────────────────────────────────────────┘
          ▼
┌─────────────────────────────────────────────────────────────┐
│                    后端 (FastAPI)                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ WebSocket   │  │ REST API    │  │ 静态文件服务         │  │
│  │ 实时通信    │  │ 用户/进度   │  │                     │  │
│  └──────┬──────┘  └─────────────┘  └─────────────────────┘  │
└─────────┼───────────────────────────────────────────────────┘
          ▼
┌─────────────────────────────────────────────────────────────┐
│                   核心模块 (app/recovery_coach/)             │
│                                                             │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐  │
│  │ pose/        │───▶│ analysis/    │───▶│ feedback/    │  │
│  │ 姿态估计     │    │ 动作分析     │    │ 反馈生成     │  │
│  │ (MediaPipe)  │    │ + 安全监测   │    │ (LLM + TTS)  │  │
│  └──────────────┘    └──────────────┘    └──────────────┘  │
│          │                  │                   │           │
│          ▼                  ▼                   ▼           │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              workflow/ (LangGraph)                   │   │
│  │   教练工作流状态机：检测→分析→反馈→追踪               │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                                │
│                            ▼                                │
│  ┌──────────────┐    ┌──────────────┐                      │
│  │ progress/    │    │ exercises/   │                      │
│  │ 进度追踪     │    │ 动作库定义   │                      │
│  │ + 勋章系统   │    │              │                      │
│  └──────────────┘    └──────────────┘                      │
└─────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据层 (SQLite)                          │
│  用户数据 │ 训练记录 │ 进度指标 │ 成就勋章                  │
└─────────────────────────────────────────────────────────────┘
```

### 模块划分

```
app/
├── main.py                    # FastAPI 入口
├── api/
│   ├── routes/
│   │   ├── websocket.py       # WebSocket 实时通信
│   │   ├── exercises.py       # 动作库 API
│   │   ├── progress.py        # 进度数据 API
│   │   └── users.py           # 用户 API
│   └── dependencies.py
│
├── recovery_coach/            # 核心康复教练模块
│   ├── __init__.py
│   │
│   ├── pose/                  # 姿态估计
│   │   ├── detector.py        # MediaPipe 封装
│   │   ├── keypoints.py       # 关键点定义与处理
│   │   └── utils.py
│   │
│   ├── exercises/             # 动作库
│   │   ├── library.py         # 动作定义
│   │   ├── validators.py      # 动作验证器
│   │   └── data/              # 标准姿态数据 (JSON)
│   │
│   ├── analysis/              # 动作分析
│   │   ├── posture.py         # 姿态分析
│   │   ├── safety.py          # 安全监测
│   │   └── scoring.py         # 动作评分
│   │
│   ├── feedback/              # 反馈系统
│   │   ├── generator.py       # AI 反馈生成 (LLM)
│   │   ├── tts.py             # 语音合成 (edge-tts)
│   │   └── visual.py          # 视觉反馈数据
│   │
│   ├── progress/              # 进度追踪
│   │   ├── tracker.py         # 指标追踪
│   │   ├── achievements.py    # 勋章系统
│   │   └── visualization.py   # 数据可视化
│   │
│   └── workflow/              # LangGraph 工作流
│       ├── graph.py           # 主工作流定义
│       ├── state.py           # 状态定义
│       └── nodes/             # 工作流节点
│           ├── detect.py
│           ├── analyze.py
│           ├── feedback.py
│           └── track.py
│
├── models/                    # 数据库模型
│   ├── user.py
│   ├── exercise.py
│   ├── session.py
│   └── achievement.py
│
├── schemas/                   # Pydantic 模式
│   ├── pose.py
│   ├── exercise.py
│   ├── feedback.py
│   └── progress.py
│
└── core/
    ├── config.py              # 配置
    └── database.py            # 数据库连接
```

### 技术选型

| 组件 | 技术 | 说明 |
|------|------|------|
| 姿态估计 | MediaPipe Pose | 33个关键点，本地运行，隐私保护 |
| 工作流 | LangGraph | 管理教练反馈的状态机 |
| LLM | Claude/OpenAI | 生成温和、专业的反馈语句 |
| TTS | edge-tts | 微软 Azure 语音，中文支持好 |
| 后端 | FastAPI | 高性能异步框架 |
| 实时通信 | WebSocket | 低延迟视频帧传输 |
| 数据库 | SQLite + SQLAlchemy | 轻量级，适合 MVP |
| 前端 | HTML/CSS/JS | 原生实现，无重框架依赖 |

### 康复动作库 (初版)

1. **呼吸训练**
   - 腹式呼吸 (Diaphragmatic Breathing)
   - 核心激活呼吸 (Core Activation Breath)

2. **盆底肌训练**
   - 凯格尔运动 (Kegel Exercise)
   - 骨盆倾斜 (Pelvic Tilt)

3. **腹直肌分离修复**
   - 死虫式 (Dead Bug) - 简化版
   - 腹部支撑 (Abdominal Bracing)

4. **体态矫正**
   - 猫牛式 (Cat-Cow Stretch)
   - 肩桥 (Glute Bridge)
   - 侧卧抬腿 (Side-Lying Leg Lift)

### 决策记录

| 日期 | 决策 | 原因 |
|------|------|------|
| 2026-01-23 | 使用 LangGraph 管理工作流 | 用户要求，便于管理复杂反馈逻辑 |
| 2026-01-23 | 使用 edge-tts 实时生成语音 | 免费、中文支持好、延迟低 |
| 2026-01-23 | 完整 Web 应用架构 | 用户选择，提供完整体验 |
| 2026-01-23 | 自定义康复动作库 | 针对产后恢复特化 |
