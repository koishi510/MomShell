# Development Environment Setup & Collaboration Guide

This document outlines the development environment setup process and collaboration standards for project contributors. To ensure cross-platform consistency and code quality, all team members must follow these steps before starting development.

## 1. System Prerequisites

Before cloning the project, ensure your operating system has the following tools installed.

### 1.1 Install uv Package Manager

This project uses uv for Python version management and dependency locking. Run the appropriate command for your operating system.

- **Linux / macOS**:
  ```bash
  curl -LsSf https://astral.sh/uv/install.sh | sh
  ```
- **Windows (PowerShell)**:
  ```powershell
  powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
  ```

**Note**: After installation, restart your terminal and run `uv --version` to verify the installation.

### 1.2 Install Git LFS

This project uses Git LFS (Large File Storage) to manage model weights and binary data files.

- **Linux**: Run `sudo apt install git-lfs` (Ubuntu example)
- **macOS**: Run `brew install git-lfs`
- **Windows**: Usually pre-installed with Git for Windows. If not, download from the official website.

After installation, run the global initialization command:

```bash
git lfs install
```

## 2. Project Initialization

After cloning the repository, run the following commands in order from the project root directory.

### 2.1 Sync Development Environment

Run the following command. uv will automatically download Python 3.11.5, create a virtual environment, and install exact dependency versions from `uv.lock`.

```bash
uv sync
```

### 2.2 Install Git Hooks (Pre-commit)

This project uses automated code checks. Run the following command to install Git hooks for automatic formatting and quality checks on commit.

```bash
uv run pre-commit install
```

## 3. IDE Configuration

We recommend VS Code for development. Configure it as follows to ensure proper interpreter and toolchain integration.

1. **Select Python Interpreter**:
   - Open Command Palette (Windows: `Ctrl+Shift+P`, macOS: `Cmd+Shift+P`)
   - Type and select `Python: Select Interpreter`
   - Choose the option containing `.venv` (usually marked as Recommended)

2. **Install Recommended Extensions**:
   - **Python** (Microsoft)
   - **Ruff** (Astral Software): For code formatting and linting
   - **Mypy** (Microsoft): For static type checking

## 4. Daily Development Workflow

Follow these guidelines to maintain a clean and stable codebase.

### 4.1 Daily Sync

Before writing code, always update your local development branch. Use `rebase` mode to maintain a linear commit history:

```bash
# Switch to dev branch and pull latest code
git checkout dev
git pull --rebase origin dev
uv sync
```

### 4.2 Running the Project

Use `uv run` to start the application within the isolated virtual environment:

- **Run Python script**:
  ```bash
  uv run python app/main.py
  ```
- **Run framework-specific commands**:
  ```bash
  uv run [framework-command] [entry-file-path]
  ```

### 4.3 Dependency Management

Do not use pip directly. Use the following commands to manage packages, ensuring `pyproject.toml` and `uv.lock` stay in sync.

- **Add production dependency** (e.g., numpy, pandas):
  ```bash
  uv add numpy
  ```
- **Add development dependency** (e.g., testing tools):
  ```bash
  uv add --dev pytest
  ```

### 4.4 Code Quality Checks

Before committing, run these checks locally:

- **Code formatting**:
  ```bash
  uv run ruff format .
  ```
- **Static analysis (Lint)**:
  ```bash
  uv run ruff check . --fix
  ```
- **Unit tests (optional)**:
  ```bash
  uv run pytest
  ```

## 5. Collaboration Standards

### 5.1 Dependency & Lock File Management

- **uv.lock**: Auto-generated by the tool. **Do not edit manually**. This file must be committed to version control to ensure team environment consistency.
- **Conflict Resolution**: If `uv.lock` conflicts after `git pull`, do not manually merge. Run `uv lock` to regenerate the lock file, then commit.

### 5.2 Large File Handling

- Before committing large binary files (.pt, .parquet, .db), verify their extensions are listed in `.gitattributes` to ensure LFS storage.

### 5.3 Code Standards

This project enforces unified code standards through automated tooling. All commits must pass CI checks:

1. **Formatting**: Follows PEP 8 and Black standards (**double quotes**, **88-character line width**, **4-space indentation**), handled by `ruff format`.
2. **Imports**: Must be ordered as "standard library > third-party > local modules". Unused imports are prohibited.
3. **Quality Control**: Code must pass linter analysis. No unused variables, risky syntax, or deprecated Python features.
4. **Type Safety**: Type hints are required and must pass Mypy static type checking.

### 5.4 Commit Message Convention

All commit messages must follow Conventional Commits format: `type: description`.

| Type         | Description                        | CI Behavior        |
| :----------- | :--------------------------------- | :----------------- |
| **feat**     | New feature                        | Triggers build/test |
| **fix**      | Bug fix                            | Triggers build/test |
| **refactor** | Code refactoring (no logic change) | Triggers build/test |
| **docs**     | Documentation only (README, comments) | **Skips CI build** |
| **chore**    | Build config or tooling changes    | **Skips CI build** |

### 5.5 Branch Management & Pull Request Process

This project uses a **dual main branch strategy** (`main` for production, `dev` for development integration).

1. **Branch Structure & Naming**:
   - **dev**: Main development branch. All feature branches should be created from here.
   - **main**: Production releases only. Direct pushes are prohibited.
   - **Feature branches**: Name as `feat/feature-name` or `fix/issue-description`.

2. **Sync & Rebase**:
   - To maintain linear history, **do not merge dev into feature branches**.
   - Before creating a Pull Request, rebase your feature branch onto the latest `dev`:
     ```bash
     git fetch origin
     git rebase origin/dev
     ```
   - If conflicts occur, resolve them locally and continue the rebase.

3. **Submission Process**:
   - Ensure `uv run pytest` passes locally.
   - Push branch to remote (may require `git push --force-with-lease` after rebase).
   - Create Pull Request with **target branch set to `dev`**.

4. **Merge Criteria**:
   - **CI Checks**: All automated tests and linter checks must pass.
   - **Code Review**: At least one team member approval required before merging.

## 6. Troubleshooting

- **Q: uv command not found?**
  - A: Check if environment variables are set or if you need to restart the terminal. Windows users should try running PowerShell as administrator.

- **Q: VS Code showing code errors?**
  - A: Verify the Python interpreter (bottom-right corner) is set to the `.venv` virtual environment, not the system Python.

- **Q: Git rejecting commits?**
  - A: Read the terminal error message carefully. Usually caused by failing pre-commit checks (formatting errors or leftover debug code). Ruff typically auto-fixes formatting issues â€” just run `git add` and `git commit` again.
